---
layout: layouts/base.njk
---
{% set resolvedContributors = contributors | resolveContributors %}
{% set articleContent = content | addHeadingIds %}
{% set tocHeadings = articleContent | extractTocHeadings %}
{% set lastModified = page.inputPath | fileLastModified %}
<article class="max-w-none">
  <h1>{{ title }}</h1>

  {% if lastModified %}
  <p class="text-sm text-zinc-600 mt-3 mb-0">Last updated: {{ lastModified | formatDateOnly }}</p>
  {% endif %}
  {% if summary %}
  <p class="italic mt-5">{{ summary }}</p>
  {% endif %}
  {% if tocHeadings.length %}
  <nav class="mt-6 rounded-lg border border-zinc-200 bg-zinc-100/50 p-4" aria-label="On this page">
    <h2 class="text-lg mt-0 mb-2 font-body font-semibold">Contents</h2>
    <ul class="my-0 list-none pl-0">
      {% set sectionIndex = 0 %}
      {% set subSectionIndex = 0 %}
      {% for heading in tocHeadings %}
      {% if heading.level == 2 %}
      {% set sectionIndex = sectionIndex + 1 %}
      {% set subSectionIndex = 0 %}
      {% elif heading.level == 3 %}
      {% if sectionIndex == 0 %}
      {% set sectionIndex = 1 %}
      {% endif %}
      {% set subSectionIndex = subSectionIndex + 1 %}
      {% endif %}
      <li class="{% if heading.level == 3 %}ml-4{% endif %} mt-1">
        <a class="inline-flex items-baseline gap-2 text-sm text-zinc-700 no-underline hover:underline"
          href="#{{ heading.id }}">
          <span class="text-xs tabular-nums text-zinc-500">
            {% if heading.level == 3 %}
            {{ sectionIndex }}.{{ subSectionIndex }}.
            {% else %}
            {{ sectionIndex }}.
            {% endif %}
          </span>
          <span>{{ heading.text }}</span>
        </a>
      </li>
      {% endfor %}
      {% if resolvedContributors.length %}
      {% set sectionIndex = sectionIndex + 1 %}
      <li class="mt-1">
        <a class="inline-flex items-baseline gap-2 text-sm text-zinc-700 no-underline hover:underline"
          href="#contributors">
          <span class="text-xs tabular-nums text-zinc-500">{{ sectionIndex }}.</span>
          <span>Contributors</span>
        </a>
      </li>
      {% endif %}
      {% if opinions and opinions.length %}
      {% set sectionIndex = sectionIndex + 1 %}
      <li class="mt-1">
        <a class="inline-flex items-baseline gap-2 text-sm text-zinc-700 no-underline hover:underline"
          href="#opinions-from-the-community">
          <span class="text-xs tabular-nums text-zinc-500">{{ sectionIndex }}.</span>
          <span>Opinions from the Community</span>
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
  <hr class="text-zinc-300 w-full my-10" />
  {{ articleContent | safe }}
</article>

{% if resolvedContributors.length %}
<section id="contributors" class="mt-12 space-y-4">
  <h2>Contributors</h2>
  <div class="flex flex-wrap items-center gap-4">
    {% for contributor in resolvedContributors %}
    <a class="inline-flex items-center gap-2 text-sm text-zinc-700 no-underline hover:underline"
      href="{{ contributor.url }}" target="_blank" rel="noreferrer">
      <img src="{{ contributor.pfp }}" alt="{{ contributor.name }}"
        class="size-8 rounded-full border border-zinc-200 object-cover" loading="lazy" />
      <span class="font-medium text-zinc-800">{{ contributor.name }}</span>
    </a>
    {% endfor %}
  </div>
</section>
{% endif %}

{% if opinions and opinions.length %}
<section id="opinions-from-the-community" class="mt-12 space-y-4">
  <h2>Opinions from the Community</h2>
  {% include "opinion-cards.njk" %}
</section>
{% endif %}
