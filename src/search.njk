---
layout: layouts/base.njk
title: Search
permalink: /search/index.html
---
<section class="space-y-4">
  <h1>Search</h1>
  <p class="italic">Search across all wiki entries.</p>

  <label class="block space-y-2" for="search-input">
    <input id="search-input" type="search" placeholder="Search the wiki"
      class="w-full rounded-xl border border-zinc-200 bg-white px-4 py-3 text-zinc-900 outline-none ring-0 focus:border-zinc-900" />
  </label>

  <div id="search-status" class="text-sm text-zinc-600"></div>
  <ul id="search-results" class="list-none space-y-3 pl-0" style="list-style: none; padding-left: 0;"></ul>
</section>

<script type="module">
  const input = document.querySelector("#search-input");
  const status = document.querySelector("#search-status");
  const resultsEl = document.querySelector("#search-results");

  const clearResults = () => {
    resultsEl.innerHTML = "";
  };

  const renderResults = (results) => {
    if (!results.length) {
      clearResults();
      status.textContent = "No results found.";
      return;
    }

    status.textContent = `${results.length} result${results.length === 1 ? "" : "s"} found.`;
    resultsEl.innerHTML = results
      .map((result) => {
        const excerpt = result.excerpt || "";
        return `
          <li class="list-none space-y-2 rounded-xl border border-zinc-200 bg-white p-5 shadow-sm" style="list-style: none;">
            <a class="text-lg font-semibold hover:underline" href="${result.url}">${result.meta.title || result.url}</a>
            ${excerpt ? `<p class="text-sm text-zinc-700">${excerpt}</p>` : ""}
          </li>
        `;
      })
      .join("");
  };

  let pagefind;
  let debounceTimer;

  try {
    pagefind = await import("/pagefind/pagefind.js");
    status.textContent = "Type to search.";
  } catch {
    status.textContent = "Search index is unavailable. Run a full build to generate Pagefind files.";
    input.disabled = true;
  }

  input.addEventListener("input", () => {
    const query = input.value.trim();
    clearTimeout(debounceTimer);

    if (!query) {
      clearResults();
      status.textContent = "Type to search.";
      return;
    }

    debounceTimer = setTimeout(async () => {
      const search = await pagefind.search(query);
      const results = await Promise.all(search.results.map((r) => r.data()));
      renderResults(results);
    }, 120);
  });
</script>
